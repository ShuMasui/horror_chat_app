ホラーチャットアプリ 基本設計書バージョン: 0.0.1 (Dev)作成日: 2026/01/13プラットフォーム: iOS / Android (Flutter)1. プロジェクト概要1.1. コンセプト「狂気を感じるチャット体験」を提供するホラーシミュレーションゲーム。ユーザーは架空のキャラクター（AI）とチャット形式で対話し、会話の進行によって恐怖演出やストーリー展開が変化する。1.2. 主要機能AIチャット機能: Google Gemini APIを利用した、自然かつ文脈に応じた動的な会話生成。恐怖演出: 会話の進行度や特定のフラグに応じた画面の揺れ（シェイク）、回転などの視覚効果。シナリオ進行管理: チャットレスポンスに含まれるメタデータによるシーン管理。2. 技術スタックカテゴリ技術・ライブラリ備考言語Dart (SDK ^3.10.0)フレームワークFlutter状態管理flutter_riverpodriverpod_annotation を使用ルーティングgo_router画面遷移管理AI モデルGoogle Generative AIgemini-2.5-flash-liteデータクラス生成freezed / json_serializable不変オブジェクトの生成環境変数管理flutter_dotenvAPIキー等の管理3. 機能要件3.1. チャットシステム (Core)対話エンジン: GoogleAiService クラスが Gemini API との通信を担当。初期プロンプト: * キャラクター設定：「感情的に依存し、執着する恋人（メンヘラ気質）」トーン：深い愛情、極度の不安、罪悪感の植え付け、反復的な言い回し。メッセージ送信: ユーザーの入力テキストを送信し、AIからの応答を表示。演出:TypeWriterWidget: AIの返信を一文字ずつ表示し、リアルタイムな入力感を演出。LeftLoadingBubble: 通信中の「入力中...」アニメーション表示。3.2. 演出エフェクト (Horror Effects)ゲームの状態（State）に応じて、以下の画面エフェクトをトリガーする。Shake Effect (EffectShakeScreen): 画面全体を小刻みに振動させる。恐怖や動揺を表現。Rotate Effect (EffectRotateScreen): 画面を傾ける、または回転させる。平衡感覚の喪失や狂気を表現。3.3. 画面構成画面名クラス名概要Initial ScreenInitialScreenアプリ起動時のタイトル画面または導入画面。Home ScreenHomeScreenチャット相手（フレンド）の一覧表示画面。Chat ScreenChatScreenメインのチャットインターフェース。背景画像設定あり。4. データ構造・API仕様4.1. Gemini API レスポンス形式 (JSON)AIは通常のテキストではなく、ゲーム進行制御用のメタデータを含むJSON形式で応答するよう指示される。{
  "currentScene": "{現在のシーンID}",
  "nextScene": "{次のシーンID}", 
  "message": "AIが発言するメッセージ内容"
}
currentScene: 現在のストーリー上の位置づけ。nextScene: 次に遷移すべきシーン、またはフラグ。message: ユーザーに表示されるテキスト。4.2. データモデルGameMessageチャット1件分のデータを表現する。message: 表示テキストcurrentScene: シーンIDnextScene: 次シーンIDFriends (Mock/Data)チャット相手のプロフィール情報。id: 一意のIDname: 表示名iconUrl: アイコン画像のパス（アセット）5. デザイン・アセット5.1. テーマ (theme.dart)ベース: ダークテーマ (ThemeData.dark()) ベースか、ホラーテイストのカスタム配色。フォント: システムフォントを使用。5.2. アセット構成assets/backgrounds/:wood.jpg: 木目調の背景（リスト画面等）chat.jpg: チャット画面背景assets/icons/:karikanozyo.jpg: キャラクターアイコン6. 既知の課題・検討事項 (To-Do)JSONパースの堅牢化:Gemini APIがたまに不完全なJSONを返す場合があるため、GoogleAiService 内での例外処理と再試行ロジック、およびJSON補完処理（{}の欠落対策など）が必要。APIキー管理:現在は .env で管理しているが、リリースビルド時の難読化やセキュリティ対策を検討する必要がある。状態管理の永続化:アプリを再起動するとチャット履歴が消えるため、ローカルDB（Isar, Hive, SharedPreferences等）への保存機能が必要。エフェクトのトリガー実装:GameMessage の currentScene や nextScene の値を監視し、特定の値が来た瞬間に EffectShakeScreen などを発火させるロジックの詳細な結合。
